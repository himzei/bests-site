<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ë°°ë“œë¦¼ ë² ìŠ¤íŠ¸ê¸€</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <header class="header">
            <h1>ğŸš— ë³´ë°°ë“œë¦¼ ë² ìŠ¤íŠ¸ê¸€</h1>
            <p class="subtitle">ì‹¤ì‹œê°„ ì¸ê¸° ê²Œì‹œê¸€ì„ í™•ì¸í•˜ì„¸ìš”</p>
        </header>

        <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
        <div class="controls">
            <button id="refreshBtn" class="btn-refresh">
                <span class="refresh-icon">ğŸ”„</span>
                ìƒˆë¡œê³ ì¹¨
            </button>
            <div id="lastUpdate" class="last-update">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>

        <!-- ë¡œë”© ì¸ë””ì¼€ì´í„° -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>ë² ìŠ¤íŠ¸ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
        <div id="error" class="error-message" style="display: none;"></div>

        <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
        <div id="postsContainer" class="posts-container">
            <!-- ê²Œì‹œê¸€ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>

        <!-- í‘¸í„° -->
        <footer class="footer">
            <p>ë³´ë°°ë“œë¦¼ ë² ìŠ¤íŠ¸ê¸€ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</p>
        </footer>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            loadBestPosts();
            
            // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('refreshBtn').addEventListener('click', function() {
                loadBestPosts();
            });
        });

        // ë² ìŠ¤íŠ¸ê¸€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        async function loadBestPosts() {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');
            const postsContainer = document.getElementById('postsContainer');
            const lastUpdateEl = document.getElementById('lastUpdate');
            const refreshBtn = document.getElementById('refreshBtn');

            // UI ìƒíƒœ ì´ˆê¸°í™”
            loadingEl.style.display = 'flex';
            errorEl.style.display = 'none';
            postsContainer.innerHTML = '';
            refreshBtn.disabled = true;
            refreshBtn.style.opacity = '0.6';

            try {
                // API í˜¸ì¶œ
                const response = await fetch('/health');
                const data = await response.json();

                if (data.status === 'ok') {
                    // ì„±ê³µ ì‹œ ê²Œì‹œê¸€ í‘œì‹œ
                    displayPosts(data.ê²Œì‹œê¸€_ëª©ë¡);
                    lastUpdateEl.textContent = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${data.ë°ì´í„°_ìˆ˜ì§‘_ì‹œê°„} (ì´ ${data.ê²Œì‹œê¸€_ìˆ˜}ê°œ)`;
                    lastUpdateEl.style.color = '#4CAF50';
                } else {
                    // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                    throw new Error(data.message || 'ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                // ì—ëŸ¬ ì²˜ë¦¬
                errorEl.textContent = `ì˜¤ë¥˜: ${error.message}`;
                errorEl.style.display = 'block';
                lastUpdateEl.textContent = 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨';
                lastUpdateEl.style.color = '#f44336';
            } finally {
                // ë¡œë”© ì™„ë£Œ
                loadingEl.style.display = 'none';
                refreshBtn.disabled = false;
                refreshBtn.style.opacity = '1';
            }
        }

        // ê²Œì‹œê¸€ ëª©ë¡ í‘œì‹œ í•¨ìˆ˜
        function displayPosts(posts) {
            const container = document.getElementById('postsContainer');
            
            if (!posts || posts.length === 0) {
                container.innerHTML = '<div class="no-posts">í‘œì‹œí•  ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            // ê²Œì‹œê¸€ ì¹´ë“œ ìƒì„±
            const postsHTML = posts.map(post => `
                <div class="post-card">
                    <div class="post-rank">${post.ìˆœìœ„}</div>
                    <div class="post-content">
                        <h3 class="post-title">
                            <a href="${post.ë§í¬}" target="_blank" rel="noopener noreferrer">
                                ${escapeHtml(post.ì œëª©)}
                            </a>
                        </h3>
                        <div class="post-meta">
                            <span class="meta-item">
                                <span class="meta-icon">ğŸ‘¤</span>
                                ${escapeHtml(post.ì‘ì„±ì)}
                            </span>
                            <span class="meta-item">
                                <span class="meta-icon">ğŸ•</span>
                                ${escapeHtml(post.ì‘ì„±ì‹œê°„)}
                            </span>
                            <span class="meta-item">
                                <span class="meta-icon">ğŸ‘ï¸</span>
                                ${escapeHtml(post.ì¡°íšŒìˆ˜)}
                            </span>
                            <span class="meta-item">
                                <span class="meta-icon">ğŸ‘</span>
                                ${escapeHtml(post.ì¶”ì²œìˆ˜)}
                            </span>
                            ${post.ëŒ“ê¸€ìˆ˜ !== 'ëŒ“ê¸€ìˆ˜ ì—†ìŒ' ? `
                                <span class="meta-item">
                                    <span class="meta-icon">ğŸ’¬</span>
                                    ${escapeHtml(post.ëŒ“ê¸€ìˆ˜)}
                                </span>
                            ` : ''}
                        </div>
                    </div>
                    <div class="post-link-icon">ğŸ”—</div>
                </div>
            `).join('');

            container.innerHTML = postsHTML;
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜ (XSS ë°©ì§€)
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
